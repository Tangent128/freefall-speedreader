<!DOCTYPE html>
<html>
<head>
<title>Flyweight Table</title>
<script src="jquery-1.11.0.min.js"></script>
<script src="flytable.js"></script>

<script>

//http://freefall.purrsia.com/ff100/fv00001.gif
//http://freefall.purrsia.com/ff400/fv00376.gif
//http://freefall.purrsia.com/ff1300/fc01253.png

$(function() {

	var table = setupFlyTable($("#contain"));
	window.DebugTable = table;
	var tmpl = $(".tmpl .comic");

	function fixedLen(num,len){
		return("0000000000000000"+num).slice(-len);
	};
	
	// comic dimension data
	var numComics = 2650;
	var firstColor = 1253;
	var height = 320;
	
	function getUrl(num) {
		var bin = ((~~((num - 1) / 100)) * 100) + 100;
		//bin = fixedLen(bin, 3);
		num = fixedLen(num, 5);
		
		if(num == 1401) {
			// special case
			return "http://freefall.purrsia.com/ff1500/fc01401.jpg";
		} else if(num >= firstColor) {
			return "http://freefall.purrsia.com/ff"+bin+"/fc"+num+".png";
		} else {
			return "http://freefall.purrsia.com/ff"+bin+"/fv"+num+".gif";
		}
	};
	
	
	// flytable config
	table.scrollPadding = 400;

	table.getTotalHeight = function() {
		return numComics * height;
	};
	
	table.getItemTop = function(index) {
		return height*index;
	};
	table.getItemHeight = function(index) {
		return height;
	};

	table.pixelToIndex = function(y) {
		return ~~(y / height);
	}

	table.getComponent = function(index, node) {
		if(!node) {
			node = tmpl.clone();
		}
		// 1-index comics
		index = index + 1;
		var url = getUrl(index);
		//node.find(".dbg").text(url);
		node.find(".num").text(index);
		node.find("img").attr("src", url).show();
		
		return node;
	};
	table.recycleComponent = function(node) {
		node.find("img").attr("src", null);
	};

	// event hookup
	$(document).on("scroll", function() {
		table.render();
	});
	
	table.render();

})

</script>

<style>
.tmpl {
	display: none;
}
.comic {
	width: 1100px;
}
.comic .bg {
	position: absolute;
	display: block;
	/*background: #eee;*/
	border-radius: 32px;
	top: 0; left: 0; right: 0; bottom: 0;
}
.comic .num {
	position: absolute;
	top: 0; right: 32px;
	color: black;
	font-weight: bold;
	background: white;
	padding: 3px;
	z-index: 1;
}
.comic img {
	position: absolute;
	top: 0; left: 32px;
	z-index: 0;
}
</style>
</head>
<body>

<div id="contain"></div>

<hr />

<div class="tmpl">
<div class="comic">
<div class="bg">
<span class="dbg"></span>
<span class="num"></span>
<img />
</div>
</div>
</div>

</body>
</html>

